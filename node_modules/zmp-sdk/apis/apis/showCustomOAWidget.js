import o from'./../external/@swc/helpers/src/_async_to_generator.mjs.js';import t from'./../external/@swc/helpers/src/_object_without_properties.mjs.js';import n from'./../external/@swc/helpers/src/_sliced_to_array.mjs.js';import e,{object as r,string as i}from'./../external/zod/lib/index.mjs.js';import s from"../appEnv/index.js";import a from"../common/notFound.js";import{functionHandler as l}from"../utils/decorator.js";import c from"../common/token.js";import u from"../common/apis/general/openProfile.js";import{base64EncodeUnicode as m,setSearchParams as d}from"../utils/common.js";import{WIDGET_URLS as p,ALLOW_WIDGET_ORIGIN as h}from"../constants.js";import{__generator as f}from'./../external/tslib/tslib.es6.js';var g,b=[r({id:i(),textColor:e.string().optional(),fontSize:e.string().optional(),buttonHeight:e.string().optional(),buttonColor:e.string().optional(),buttonTextColor:e.string().optional(),buttonRadius:e.string().optional(),buttonText:e.string().optional(),checkboxBGColor:e.string().optional(),checkboxCheckmarkColor:e.string().optional(),onClick:e.function().optional(),onStatusChange:e.function().optional(),onError:e.function().optional()}).catchall(e.any())];function C(o){return x.apply(this,arguments)}function x(){return x=o((function(e){return f(this,(function(r){return[2,l("showCustomOAWidget",b,[e],(i=o((function(e){var r,i,l,b,C,x,j,y,k,w,v,_,T,E,O,S,A,P,I,R,B;return f(this,(function(H){if(s.isMp){try{r=document.getElementById(e.id),i=e.textColor,l=e.fontSize,b=e.buttonHeight,C=e.buttonColor,x=e.buttonTextColor,j=e.buttonRadius,y=e.buttonText,k=e.checkboxBGColor,w=e.checkboxCheckmarkColor,v=e.onStatusChange,_=e.onClick,T=e.onError,E=t(e,["textColor","fontSize","buttonHeight","buttonColor","buttonTextColor","buttonRadius","buttonText","checkboxBGColor","checkboxCheckmarkColor","onStatusChange","onClick","onError"]),r&&(O=document.createElement("iframe"),S="ifCOAW-".concat(e.id,"-").concat(Date.now()),A=new URL(p.CUSTOM_OA),P={id:S,appId:window.APP_ID,textColor:i,fontSize:l,buttonHeight:b,buttonColor:C,buttonTextColor:x,buttonRadius:j,buttonText:y,checkboxBGColor:k,checkboxCheckmarkColor:w},Object.entries(E).forEach((function(o){var t=n(o,2),e=t[0],r=t[1];r&&(P["data-".concat(e)]=String(r))})),I=JSON.stringify(P),R=m(I),B=encodeURIComponent(R),d(A.searchParams,"data",B),O.id=S,O.src=A.href,O.style.width="100%",O.style.height="100%",O.style.border="none",r.innerHTML=O.outerHTML,window.removeEventListener("message",g,!1),g=function(){var t=o((function(o){var t,n,e,r,i,s,a,l,m;return f(this,(function(d){switch(d.label){case 0:return t=o.data,o.origin.startsWith(h)?(n=document.getElementById(S),e=t.type,(r=new URL(t.href)).origin!==A.origin||r.pathname!==A.pathname||t.id!==S?[3,3]:"followOA"!==e&&"getOAInfo"!==e?[3,2]:[4,c.jumpAndGetToken()]):[3,3];case 1:return d.sent(),a=null===(i=c.miniProgramConfig)||void 0===i?void 0:i.jwt,null==n||null===(s=n.contentWindow)||void 0===s||s.postMessage({type:e,payload:{jwt:a}},h),[3,3];case 2:"oaInfo"===e?null==v||v(null===(l=t.payload)||void 0===l?void 0:l.followed):"openOA"===e?u(t.payload.id,"oa"):"heightChange"===e?n.style.height="".concat(t.payload,"px"):"onClick"===e?null==_||_(null===(m=t.payload)||void 0===m?void 0:m.status):"onError"===e&&(null==T||T(t.payload)),d.label=3;case 3:return[2]}}))}));return function(o){return t.apply(this,arguments)}}(),window.addEventListener("message",g,!1))}catch(o){console.log(o)}return[2,Promise.resolve()]}return s.isMpWeb?[2,Promise.resolve()]:[2,Promise.reject(a("showCustomOAWidget",{}))]}))})),function(o){return i.apply(this,arguments)}))];var i}))})),x.apply(this,arguments)}export{C as showCustomOAWidget};
