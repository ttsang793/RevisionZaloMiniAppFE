import e from'./../../../../external/@swc/helpers/src/_async_to_generator.mjs.js';import r from'./../../../../external/@swc/helpers/src/_object_spread.mjs.js';import o from'./../../../../external/@swc/helpers/src/_object_spread_props.mjs.js';import s from"../../../token.js";import{apiResponse as t}from"../../../../utils/response.js";import{PAYMENT_APIS as n,APP_ID as a}from"../../../../constants.js";import c from"../showPaymentConfirm.js";import{__generator as d}from'./../../../../external/tslib/tslib.es6.js';var m,p=(m=e((function(e,m,p,i,l){var u,h,f,j,w,_,g,b,y,T,C,I;return d(this,(function(d){switch(d.label){case 0:u=a,(h=new URLSearchParams).append("amount",e.toString()),h.append("appId",u),m&&h.append("desc",encodeURIComponent(m)),p&&h.append("method",p),i&&h.append("transId",i),l&&h.append("mac",l),f={headers:{"Content-Type":"application/x-www-form-urlencoded",authorization:"Bearer "}},d.label=1;case 1:return d.trys.push([1,10,,11]),[4,s.getAccessToken().catch((function(){throw t.error.loginRequired}))];case 2:return w=d.sent(),f.headers.authorization="Bearer ".concat(w),console.log("_purchase"),[4,s.jumpAndGetToken()];case 3:if(d.sent(),_=null===(j=s.miniProgramConfig)||void 0===j?void 0:j.showConfirmToPayment,console.log("showConfirmToPayment",_),!_)return[3,7];d.label=4;case 4:return d.trys.push([4,6,,7]),[4,c()];case 5:return d.sent(),[3,7];case 6:throw g=d.sent(),console.error("Failed:",g),g;case 7:return[4,fetch(n.PURCHASE,o(r({method:"POST"},f),{body:h}))];case 8:return[4,d.sent().json()];case 9:if(!(b=d.sent()).data||0!==b.err)throw t.error.badRequest(b.msg);return y=b.data.id,T=b.data.messageToken||"",C=b.data.transId||"",[2,{orderId:y,messageToken:T,transId:C}];case 10:throw I=d.sent(),console.log("Internal error"),I;case 11:return[2]}}))})),function(e,r,o,s,t){return m.apply(this,arguments)});export{p as default};
