import e from'./../../../../external/@swc/helpers/src/_async_to_generator.mjs.js';import r from'./../../../../external/@swc/helpers/src/_object_spread.mjs.js';import o from'./../../../../external/@swc/helpers/src/_object_spread_props.mjs.js';import s from"../../../token.js";import{apiResponse as t}from"../../../../utils/response.js";import{PAYMENT_APIS as n}from"../../../../constants.js";import a from"../showPaymentConfirm.js";import{__generator as d}from'./../../../../external/tslib/tslib.es6.js';var m,i=(m=e((function(e,m,i,c,p){var l,u,h,f,j,w,_,g,b,y,C;return d(this,(function(d){switch(d.label){case 0:(l=new URLSearchParams).append("amount",e.toString()),m&&l.append("desc",encodeURIComponent(m)),i&&l.append("method",i),c&&l.append("transId",c),p&&l.append("mac",p),u={headers:{"Content-Type":"application/x-www-form-urlencoded",authorization:"Bearer "}},d.label=1;case 1:return d.trys.push([1,9,,10]),[4,s.jumpAndGetToken()];case 2:if(d.sent(),j=null===(h=s.miniProgramConfig)||void 0===h?void 0:h.jwt,u.headers.authorization="Bearer ".concat(j),!(null===(f=s.miniProgramConfig)||void 0===f?void 0:f.showConfirmToPayment))return[3,6];d.label=3;case 3:return d.trys.push([3,5,,6]),[4,a()];case 4:return d.sent(),[3,6];case 5:throw w=d.sent(),console.error("Failed:",w),w;case 6:return[4,fetch(n.PURCHASE,o(r({method:"POST"},u),{body:l}))];case 7:return[4,d.sent().json()];case 8:if(!(_=d.sent()).data||0!==_.err)throw t.error.badRequest(_.msg);return g=_.data.id,b=_.data.messageToken||"",y=_.data.transId||"",[2,{orderId:g,messageToken:b,transId:y}];case 9:throw C=d.sent(),console.log("Internal error"),C;case 10:return[2]}}))})),function(e,r,o,s,t){return m.apply(this,arguments)});export{i as default};
