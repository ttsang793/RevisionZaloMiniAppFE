import e from'./../../../external/@swc/helpers/src/_async_to_generator.mjs.js';import n from"../../token.js";import{APIS as t,APP_ID as r,MESSAGES as o}from"../../../constants.js";import{canUseAccessTokenByDefault as i}from"../../../utils/common.js";import{AppError as s}from"../../../utils/errorHandler.js";import{__generator as l}from'./../../../external/tslib/tslib.es6.js';var a,c=(a=e((function(a,c){var u,d,m,f;return l(this,(function(v){switch(v.label){case 0:return(d=c)?[3,2]:[4,i()];case 1:d=!v.sent(),v.label=2;case 2:return u=d,[4,n.getAccessToken(u)];case 3:return m=v.sent(),f="id,name,user_id_by_oa,is_sensitive",f=a?"".concat(f,",picture.type(").concat(a,")"):"".concat(f,",picture"),[4,fetch("".concat(t.GET_USER_INFO,"?fields=").concat(f,"&miniapp_id=").concat(r),{headers:{access_token:m||""}}).then(function(){var n=e((function(e){var n,t,r,i,a,c;return l(this,(function(l){switch(l.label){case 0:return[4,e.json()];case 1:if(r=l.sent(),void 0!==(i=null==r?void 0:r.error)&&i<0)throw a=(null==r?void 0:r.message)||o.UNKNOWN_ERROR,new s(i,a);return c=null==r?void 0:r.user_id_by_oa,[2,{id:null==r?void 0:r.id,name:(null==r?void 0:r.name)||"",avatar:(null==r||null===(n=r.picture)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.url)||"",idByOA:c,followedOA:!!(null==r?void 0:r.is_follower),isSensitive:null==r?void 0:r.is_sensitive}]}}))}));return function(e){return n.apply(this,arguments)}}())];case 4:return[2,v.sent()]}}))})),function(e,n){return a.apply(this,arguments)});export{c as default};
