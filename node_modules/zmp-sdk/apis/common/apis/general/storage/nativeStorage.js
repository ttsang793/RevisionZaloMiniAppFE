import s from'./../../../../external/@swc/helpers/src/_assert_this_initialized.mjs.js';import e from'./../../../../external/@swc/helpers/src/_async_to_generator.mjs.js';import t from'./../../../../external/@swc/helpers/src/_class_call_check.mjs.js';import r from'./../../../../external/@swc/helpers/src/_class_private_field_get.mjs.js';import a from'./../../../../external/@swc/helpers/src/_class_private_field_init.mjs.js';import n from'./../../../../external/@swc/helpers/src/_class_private_field_set.mjs.js';import i from'./../../../../external/@swc/helpers/src/_inherits.mjs.js';import o from'./../../../../external/@swc/helpers/src/_create_super.mjs.js';import{ResourceStorage as d}from"./storage.js";import m from"../../../../utils/lodash.js";import{STORAGE_LIMIT as p}from"../../../../constants.js";import c from"../../../call/index.js";import{convertError as u}from"../../../../utils/response.js";import{__generator as _}from'./../../../../external/tslib/tslib.es6.js';var l=new WeakMap,f=new WeakMap,h=function(d){i(v,d);var h=o(v);function v(e){var r;return t(this,v),r=h.call(this),a(s(r),l,{writable:!0,value:void 0}),a(s(r),f,{writable:!0,value:void 0}),n(s(r),f,{keys:new Set,currentSize:0,limitSize:p}),n(s(r),l,e),r}var y=v.prototype;return y.get=function(s){var t=this;return e((function(){return _(this,(function(e){return[2,new Promise((function(e,a){c("ZBROWSER_MPDS",{mpds_action:"mpds.get",mpds_data:{keys:s},appId:r(t,l)},{success:function(s){var t=new Map;s&&s.mpds_data&&s.mpds_data.map&&(t=new Map(Object.entries(s.mpds_data.map))),e(t)},fail:function(s){a(s)}},{isMultiCallback:!1})}))]}))}))()},y.getSynchronize=function(s){var e={mpds_action:"mpds.get",mpds_data:{keys:s},appId:r(this,l)},t=new Map,a=this.handleResult(e);return a&&a.mpds_data&&a.mpds_data.map&&(t=new Map(Object.entries(a.mpds_data.map))),t},y.set=function(s){var t=this;return e((function(){return _(this,(function(e){return[2,new Promise((function(e,a){c("ZBROWSER_MPDS",{mpds_action:"mpds.set",mpds_data:{map:s},appId:r(t,l)},{success:function(s){var t=[];s&&s.mpds_data&&s.mpds_data.error_keys&&(t=s.mpds_data.error_keys),e({errorKeys:t})},fail:function(s){a(s)}},{isMultiCallback:!1})}))]}))}))()},y.setSynchronize=function(s){var e={mpds_action:"mpds.set",mpds_data:{map:s},appId:r(this,l)},t=[],a=this.handleResult(e);return a&&a.mpds_data&&a.mpds_data.error_keys&&(t=a.mpds_data.error_keys),{errorKeys:t}},y.getInfo=function(){var s=this;return e((function(){return _(this,(function(e){return[2,new Promise((function(e,t){c("ZBROWSER_MPDS",{mpds_action:"mpds.get.size",mpds_data:{},appId:r(s,l)},{success:function(s){var t=0;s&&s.mpds_data&&s.mpds_data.size&&(t=s.mpds_data.size),e({currentSize:m.isNumber(t)?Number(Number(t)/1024):0,limitSize:Number(p/1024)})},fail:function(s){t(s)}},{isMultiCallback:!1})}))]}))}))()},y.getInfoSynchronize=function(){var s={mpds_action:"mpds.get.size",mpds_data:{},appId:r(this,l)},e=0,t=this.handleResult(s);return t&&t.mpds_data&&t.mpds_data.size&&(e=t.mpds_data.size),{currentSize:m.isNumber(e)?Number(Number(e)/1024):0,limitSize:Number(p/1024)}},y.remove=function(s){var t=this;return e((function(){return _(this,(function(e){return[2,new Promise((function(e,a){c("ZBROWSER_MPDS",{mpds_action:"mpds.remove.key",mpds_data:{keys:s},appId:r(t,l)},{success:function(s){var t=[];s&&s.mpds_data&&s.mpds_data.error_keys&&(t=s.mpds_data.error_keys),e({errorKeys:t})},fail:function(s){a(s)}},{isMultiCallback:!1})}))]}))}))()},y.removeSynchronize=function(s){var e={mpds_action:"mpds.remove.key",mpds_data:{keys:s},appId:r(this,l)},t=[],a=this.handleResult(e);return a&&a.mpds_data&&a.mpds_data.error_keys&&(t=a.mpds_data.error_keys),{errorKeys:t}},y.clearAsync=function(){var s=this;return e((function(){return _(this,(function(e){return[2,new Promise((function(e,t){c("ZBROWSER_MPDS",{mpds_action:"mpds.clear.appData",mpds_data:{},appId:r(s,l)},{success:function(){e()},fail:function(s){t(s)}},{isMultiCallback:!1})}))]}))}))()},y.clearSynchronize=function(){var s={mpds_action:"mpds.clear.appData",mpds_data:{},appId:r(this,l)};this.handleResult(s)},y.handleResult=function(s){var e=null;try{var t=ZaloJavaScriptInterface.processActionMPDS(JSON.stringify(s));if(t=JSON.parse(t)){if(0===t.error_code)return t.data;e=u(t).toJSON()}}catch(s){e=s}finally{if(null!==e)throw e}return{}},v}(d);export{h as NativeResourceStorage};
