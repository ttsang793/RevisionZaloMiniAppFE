import e from'./../../../external/@swc/helpers/src/_async_to_generator.mjs.js';import r from'./../../../external/@swc/helpers/src/_object_spread.mjs.js';import t from'./../../../external/@swc/helpers/src/_object_spread_props.mjs.js';import n from"../../call/index.js";import i from"../../token.js";import{ZAPP_ID as s,APP_ID as l,ZALO_SUPPORT_SHARE_MULTI_IMAGE_VERSION as o}from"../../../constants.js";import a from"./getZMPShareInfo.js";import{getZaloVersionCode as u}from"../../utils.js";import{__generator as d}from'./../../../external/tslib/tslib.es6.js';import{ShareSheetType as c}from"../../../types/enum.js";import m from"../../../appEnv/getEnv.js";var p,h=(p=e((function(e,p){var h,v,f,g,_,j,U,w,b,I,k;return d(this,(function(d){switch(d.label){case 0:switch(h={},v=e,e){case"text":return[3,1];case"image":return[3,2];case"gif":return[3,3];case"video":return[3,4];case"link":return[3,5];case"oa":return[3,6];case"zmp":return[3,7];case"zmp_deep_link":return[3,10]}return[3,13];case 1:return h={text:null==p?void 0:p.text,desc:(null==p?void 0:p.desc)||(null==p?void 0:p.description),autoParseLink:(null==p?void 0:p.autoParseLink)?1:0},[3,14];case 2:return _=[],j=u(),U=(null===(g=m())||void 0===g?void 0:g.platformName)||"unknown",Number(j)>=o[U]&&(v="multi_image"),Array.isArray(null==p?void 0:p.imageUrls)&&(null==p?void 0:p.imageUrls.length)>0?_=null==p?void 0:p.imageUrls:_.push(null==p?void 0:p.imageUrl),h={photoUrls:_,photoUrl:null==p?void 0:p.imageUrl,caption:null==p?void 0:p.caption},[3,14];case 3:return h={photoUrl:null==p?void 0:p.imageUrl,gifUrl:null==p?void 0:p.gifUrl,width:null==p?void 0:p.width,height:null==p?void 0:p.height},[3,14];case 4:return h={videoThumb:null==p?void 0:p.videoThumb,videoUrl:null==p?void 0:p.videoUrl,width:null==p?void 0:p.width,height:null==p?void 0:p.height},[3,14];case 5:return h={link:null==p?void 0:p.link,chatOnly:(null==p?void 0:p.chatOnly)?1:0},[3,14];case 6:return h={uid:null==p?void 0:p.id},[3,14];case 7:case 10:return[4,i.getAccessToken()];case 8:case 11:return f=d.sent(),[4,a(l,f||"",(null==p?void 0:p.title)||"",(null==p?void 0:p.description)||"",(null==p?void 0:p.thumbnail)||"",null==p?void 0:p.path)];case 9:return w=d.sent(),h={data:{ZInstantAPIInfo:{url:"".concat(w.zinstantApi),zinstantdata_id:"templateId=".concat(w.ztemplateId,"&appId=").concat(l,"&shareId=").concat(w.shareId)},previewMsgText:{msg:{en:"Zalo Mini Program",vi:"Chương trình nhỏ"}},enableReactions:1}},[3,14];case 12:return b=d.sent().shareableLink,I=new URL(b),k=I.searchParams.getAll("zshareId"),I.searchParams.delete("zshareId"),k.length>0&&I.searchParams.append("zshareId",k[0]),h={link:I.href,chatOnly:0},[3,14];case 13:return[3,14];case 14:return[2,new Promise((function(e,i){n("OPEN_SHARESHEET",t(r({type:c[v]},h),{zapp:s}),{success:function(r){e({status:null==r?void 0:r.status,shareType:null==r?void 0:r.share_type,numberOfUser:null==r?void 0:r.uid_to_size})},fail:function(e){i(e)}},{timeout:!1})}))]}}))})),function(e,r){return p.apply(this,arguments)});export{h as default};
