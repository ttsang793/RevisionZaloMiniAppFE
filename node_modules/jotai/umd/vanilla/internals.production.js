!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).jotaiVanillaInternals={})}(this,function(n){"use strict";function e(n,e){(null==e||e>n.length)&&(e=n.length);for(var r=0,t=Array(e);r<e;r++)t[r]=n[r];return t}function r(n,r){var t="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(t)return(t=t.call(n)).next.bind(t);if(Array.isArray(n)||(t=function(n,r){if(n){if("string"==typeof n)return e(n,r);var t={}.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?e(n,r):void 0}}(n))||r){t&&(n=t);var a=0;return function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function t(n,e){return n.unstable_is?n.unstable_is(e):e===n}function a(n){return"init"in n}function o(n){return!!n.write}function i(n){return"v"in n||"e"in n}function u(n){if("e"in n)throw n.e;return n.v}var l=new WeakMap;function f(n){var e;return v(n)&&!(null==(e=l.get(n))||!e[0])}function d(n){var e=l.get(n);null!=e&&e[0]&&(e[0]=!1,e[1].forEach(function(n){return n()}))}function c(n,e){var r=l.get(n);if(!r){r=[!0,new Set],l.set(n,r);var t=function(){r[0]=!1};n.then(t,t)}r[1].add(e)}function v(n){return"function"==typeof(null==n?void 0:n.then)}function s(n,e,r){if(!r.p.has(n)){r.p.add(n);var t=function(){return r.p.delete(n)};e.then(t,t)}}function y(n,e,t){for(var a,o=new Set,i=r((null==(u=t.get(n))?void 0:u.t)||[]);!(a=i()).done;){var u,l=a.value;t.has(l)&&o.add(l)}for(var f,d=r(e.p);!(f=d()).done;){var c=f.value;o.add(c)}return o}var h=function(){var n={},e=new WeakMap,r=function(r){var t,a;null==(t=e.get(n))||t.forEach(function(n){return n(r)}),null==(a=e.get(r))||a.forEach(function(n){return n()})};return r.add=function(r,t){var a=r||n,o=(e.has(a)?e:e.set(a,new Set)).get(a);return o.add(t),function(){null==o||o.delete(t),o.size||e.delete(a)}},r};var p=function(n,e){for(var r=arguments.length,t=new Array(r>2?r-2:0),a=2;a<r;a++)t[a-2]=arguments[a];return e.read.apply(e,t)},g=function(n,e){for(var r=arguments.length,t=new Array(r>2?r-2:0),a=2;a<r;a++)t[a-2]=arguments[a];return e.write.apply(e,t)},w=function(n,e){return null==e.unstable_onInit?void 0:e.unstable_onInit(n)},A=function(n,e,r){return null==e.onMount?void 0:e.onMount(r)},m=function(n,e){var r=P(n),t=r[0],a=r[9],o=t.get(e);return o||(o={d:new Map,p:new Set,n:0},t.set(e,o),null==a||a(n,e)),o},N=function(n){var e=P(n),r=e[1],t=e[3],a=e[4],o=e[5],i=e[6],u=e[13],l=[],f=function(n){try{n()}catch(n){l.push(n)}},d=function(){i.f&&f(i.f);var e=new Set,l=e.add.bind(e);t.forEach(function(n){var e;return null==(e=r.get(n))?void 0:e.l.forEach(l)}),t.clear(),o.forEach(l),o.clear(),a.forEach(l),a.clear(),e.forEach(f),t.size&&u(n)};do{d()}while(t.size||o.size||a.size);if(l.length)throw new AggregateError(l)},b=function(n){for(var e=P(n),t=e[1],a=e[2],o=e[3],i=e[11],u=e[14],l=e[17],f=[],d=new WeakSet,c=new WeakSet,v=Array.from(o);v.length;){var s=v[v.length-1],h=i(n,s);if(c.has(s))v.pop();else if(d.has(s))a.get(s)===h.n&&f.push([s,h]),c.add(s),v.pop();else{d.add(s);for(var p,g=r(y(s,h,t));!(p=g()).done;){var w=p.value;d.has(w)||v.push(w)}}}for(var A=f.length-1;A>=0;--A){for(var m,N=f[A],b=N[0],E=!1,S=r(N[1].d.keys());!(m=S()).done;){var I=m.value;if(I!==b&&o.has(I)){E=!0;break}}E&&(u(n,b),l(n,b)),a.delete(b)}},E=function(n,e){var r=P(n),l=r[1],d=r[2],y=r[3],h=r[6],p=r[7],g=r[11],w=r[12],A=r[13],m=r[14],N=r[16],b=r[17],E=g(n,e);if(i(E)){if(l.has(e)&&d.get(e)!==E.n)return E;if(Array.from(E.d).every(function(e){var r=e[0],t=e[1];return m(n,r).n===t}))return E}E.d.clear();var S,I,T=!0;function _(){l.has(e)&&(b(n,e),A(n),w(n))}var R={get signal(){return S||(S=new AbortController),S.signal},get setSelf(){return!I&&o(e)&&(I=function(){if(!T)try{for(var r=arguments.length,t=new Array(r),a=0;a<r;a++)t[a]=arguments[a];return N.apply(void 0,[n,e].concat(t))}finally{A(n),w(n)}}),I}},L=E.n;try{var M=p(n,e,function(r){if(t(e,r)){var o=g(n,r);if(!i(o)){if(!a(r))throw new Error("no atom init");k(n,r,r.init)}return u(o)}var d=m(n,r);try{return u(d)}finally{var c;E.d.set(r,d.n),f(E.v)&&s(e,E.v,d),null==(c=l.get(r))||c.t.add(e),T||_()}},R);return k(n,e,M),v(M)&&(c(M,function(){var n;return null==(n=S)?void 0:n.abort()}),M.then(_,_)),E}catch(n){return delete E.v,E.e=n,++E.n,E}finally{T=!1,L!==E.n&&d.get(e)===L&&(d.set(e,E.n),y.add(e),null==h.c||h.c(e))}},S=function(n,e){for(var t=P(n),a=t[1],o=t[2],i=t[11],u=[e];u.length;)for(var l,f=u.pop(),d=r(y(f,i(n,f),a));!(l=d()).done;){var c=l.value,v=i(n,c);o.set(c,v.n),u.push(c)}},I=function(n,e){var r=P(n),o=r[3],i=r[6],l=r[8],f=r[11],d=r[12],c=r[13],v=r[14],s=r[15],y=r[17],h=!0;try{for(var p=arguments.length,g=new Array(p>2?p-2:0),w=2;w<p;w++)g[w-2]=arguments[w];return l.apply(void 0,[n,e,function(e){return u(v(n,e))},function(r){var u=f(n,r);try{for(var l=arguments.length,v=new Array(l>1?l-1:0),p=1;p<l;p++)v[p-1]=arguments[p];if(t(e,r)){if(!a(r))throw new Error("atom not writable");var g=u.n,w=v[0];return k(n,r,w),y(n,r),void(g!==u.n&&(o.add(r),null==i.c||i.c(r),s(n,r)))}return I.apply(void 0,[n,r].concat(v))}finally{h||(c(n),d(n))}}].concat(g))}finally{h=!1}},T=function(n,e){var t=P(n),a=t[1],o=t[3],i=t[6],u=t[11],l=t[15],d=t[18],c=t[19],v=u(n,e),s=a.get(e);if(s&&!f(v.v)){for(var y,h=r(v.d);!(y=h()).done;){var p=y.value,g=p[0],w=p[1];if(!s.d.has(g)){var A=u(n,g);d(n,g).t.add(e),s.d.add(g),w!==A.n&&(o.add(g),null==i.c||i.c(g),l(n,g))}}for(var m,N=r(s.d||[]);!(m=N()).done;){var b=m.value;if(!v.d.has(b)){s.d.delete(b);var E=c(n,b);null==E||E.t.delete(e)}}}},_=function(n,e){var t=P(n),a=t[1],i=t[4],u=t[6],l=t[10],f=t[11],d=t[12],c=t[13],v=t[14],s=t[16],y=f(n,e),h=a.get(e);if(!h){v(n,e);for(var p,g=r(y.d.keys());!(p=g()).done;){var w=p.value;_(n,w).t.add(e)}if(h={l:new Set,d:new Set(y.d.keys()),t:new Set},a.set(e,h),null==u.m||u.m(e),o(e)){i.add(function(){var r=!0;try{var t=l(n,e,function(){try{for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return s.apply(void 0,[n,e].concat(a))}finally{r||(c(n),d(n))}});t&&(h.u=function(){r=!0;try{t()}finally{r=!1}})}finally{r=!1}})}}return h},R=function(n,e){var t=P(n),a=t[1],o=t[5],i=t[6],u=t[11],l=t[19],f=u(n,e),d=a.get(e);if(!d||d.l.size||Array.from(d.t).some(function(n){var r;return null==(r=a.get(n))?void 0:r.d.has(e)}))return d;d.u&&o.add(d.u),d=void 0,a.delete(e),null==i.u||i.u(e);for(var c,v=r(f.d.keys());!(c=v()).done;){var s=l(n,c.value);null==s||s.t.delete(e)}},k=function(n,e,t){var a=P(n)[11],o=a(n,e),i="v"in o,u=o.v;if(v(t))for(var l,f=r(o.d.keys());!(l=f()).done;){s(e,t,a(n,l.value))}o.v=t,delete o.e,i&&Object.is(u,o.v)||(++o.n,v(u)&&d(u))},L=function(n,e){return u((0,P(n)[14])(n,e))},M=function(n,e){var r=P(n),t=r[12],a=r[13],o=r[16];try{for(var i=arguments.length,u=new Array(i>2?i-2:0),l=2;l<i;l++)u[l-2]=arguments[l];return o.apply(void 0,[n,e].concat(u))}finally{a(n),t(n)}},z=function(n,e,r){var t=P(n),a=t[12],o=t[18],i=t[19],u=o(n,e).l;return u.add(r),a(n),function(){u.delete(r),i(n,e),a(n)}},W=new WeakMap;function P(n){return W.get(n)}n.INTERNAL_abortPromise=d,n.INTERNAL_addPendingPromiseToDependency=s,n.INTERNAL_buildStoreRev2=function(){for(var n=arguments.length,e=new Array(n),r=0;r<n;r++)e[r]=arguments[r];var t={get:function(n){return(0,P(t)[21])(t,n)},set:function(n){for(var e=P(t)[22],r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return e.apply(void 0,[t,n].concat(a))},sub:function(n,e){return(0,P(t)[23])(t,n,e)}},a=[new WeakMap,new WeakMap,new WeakMap,new Set,new Set,new Set,{},p,g,w,A,m,N,b,E,S,I,T,_,R,k,L,M,z].map(function(n,r){return e[r]||n});return W.set(t,Object.freeze(a)),t},n.INTERNAL_getBuildingBlocksRev2=P,n.INTERNAL_getMountedOrPendingDependents=y,n.INTERNAL_hasInitialValue=a,n.INTERNAL_initializeStoreHooksRev2=function(n){var e,r,t,a,o,i;return(e=n).c||(e.c=h()),(r=n).m||(r.m=h()),(t=n).u||(t.u=h()),(a=n).f||(a.f=(o=new Set,(i=function(){return o.forEach(function(n){return n()})}).add=function(n){return o.add(n),function(){return o.delete(n)}},i)),n},n.INTERNAL_isActuallyWritableAtom=o,n.INTERNAL_isAtomStateInitialized=i,n.INTERNAL_isPendingPromise=f,n.INTERNAL_isPromiseLike=v,n.INTERNAL_isSelfAtom=t,n.INTERNAL_promiseStateMap=l,n.INTERNAL_registerAbortHandler=c,n.INTERNAL_returnAtomValue=u});
